# Базовый контекст проекта: Langfuse Extension

## О проекте

**Название:** Langfuse AI Trace Analyzer  
**Цель:** AI-powered анализ трейсов для Langfuse (автоматическая детекция узких мест, проблем производительности, циклов)

## Архитектура

### Компоненты проекта:

1. **ai-back/** - Go backend
   - Размер: 858 строк (2 файла)
   - `main.go` (349 строк) - HTTP сервер, endpoints
   - `ai/client.go` (394 строк) - AI клиент для анализа
   - Зависимости: OpenRouter/Ollama для LLM
   - .env файл: критичен (API ключи)

2. **crome-ext/** - Chrome Extension
   - Размер: 78 строк TypeScript (6 файлов)
   - `injector.ts` (491 строк) - основная логика
   - `content-script/` - интеграция с Langfuse UI
   - Добавляет кнопку "AI-Анализ" в интерфейс Langfuse

3. **test-tasks/** - Тестовый проект (НЕ трогаем)
   - Используется для экспериментов
   - Оптимизация не касается

4. **cursor-langfuse-ext/** - Cursor hooks (НЕ трогаем)
   - Клон для интеграции Cursor с Langfuse

## Технологический стек

- **Backend:** Go 1.21+, Gin framework
- **Frontend:** TypeScript, Vite, Chrome Extensions API
- **AI:** OpenRouter API (Claude, GPT-4, Gemini) / Ollama
- **Observability:** Langfuse

## Стандарты кодирования

### Go:
- **Архитектура:** Clean Architecture (handler → service → repository)
- Обработка ошибок: всегда проверять, логировать с контекстом
- Тесты: testify для assertions
- Комментарии: Godoc для экспортируемых функций
- **Расширяемость:** Интерфейсы для всех зависимостей (DI-friendly)

### TypeScript:
- Strict mode: включен
- Типизация: избегать `any`, использовать интерфейсы
- Async/await: для всех асинхронных операций
- Chrome API: всегда проверять доступность
- **Расширяемость:** Модульная структура, легко добавлять новые фичи

### Общее:
- **Clean Architecture принципы:**
  - Независимость от фреймворков
  - Тестируемость (моки для внешних зависимостей)
  - Независимость от UI/DB/внешних сервисов
  - Бизнес-логика в центре (не зависит от деталей реализации)
- Именование: camelCase (TS/JS), snake_case (не применимо здесь)
- Коммиты: Conventional Commits (feat/fix/refactor/docs/test/chore)
- Тесты: минимум 50% coverage для критических путей

## Приоритеты оптимизации

1. **Качество кода** - типизация, обработка ошибок, читаемость
2. **Тестируемость** - unit + integration тесты
3. **Документация** - код + процесс разработки
4. **Производительность** - оптимизация узких мест

## Исключения из анализа

- `cursor-langfuse-ext/` - не трогать (внешний клон)
- `test-tasks/` - не трогать (тестовый проект)
- `node_modules/`, `dist/`, `build/` - генерируемые файлы
- `.env` файлы - не коммитить, но важны для работы

## Особенности

- **Мета-цель:** Создать воспроизводимый процесс разработки с Cursor
- **Трейсинг:** Все операции Cursor → Langfuse для анализа
- **Будущее:** Процесс будет применяться к production проектам
