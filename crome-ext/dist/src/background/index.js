console.log("AI-Analyzer Background: Service worker started");chrome.runtime.onMessage.addListener((r,l,n)=>{if(console.log("AI-Analyzer Background: Message received",r),console.log("AI-Analyzer Background: Sender info",l),r.type==="ANALYZE_TRACE"){console.log("AI-Analyzer Background: Processing ANALYZE_TRACE request");const{traceId:t,timestamp:c}=r;return t?(console.log(`AI-Analyzer Background: Analyzing trace: ${t}`),console.log(`AI-Analyzer Background: Request timestamp: ${c}`),fetch("http://localhost:8080/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({traceId:t})}).then(e=>{console.log("AI-Analyzer Background: Backend response status:",e.status);const o=e.status;return e.json().then(a=>({status:o,data:a}))}).then(({status:e,data:o})=>{if(console.log("AI-Analyzer Background: Backend response data:",o),e===429){const s=o.retryAfter||10;n({error:`â±ï¸ Ð¡Ð»Ð¸ÑˆÐºÐ¾Ð¼ Ð¼Ð½Ð¾Ð³Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð². ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð¸Ñ‚Ðµ ${s} ÑÐµÐºÑƒÐ½Ð´ Ð¸ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.`});return}if(e===402){n({error:"ðŸ’³ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÐºÑ€ÐµÐ´Ð¸Ñ‚Ð¾Ð² Ð´Ð»Ñ AI Ð°Ð½Ð°Ð»Ð¸Ð·Ð°. ÐŸÐ¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð±Ð°Ð»Ð°Ð½Ñ Ð½Ð° OpenRouter."});return}if(e!==200)throw new Error(o.error||`HTTP ${e}`);const a={data:{status:"ÐÐ½Ð°Ð»Ð¸Ð· Ð·Ð°Ð²ÐµÑ€ÑˆÑ‘Ð½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾",analyzedTraceId:t,timestamp:new Date().toISOString(),...o.data}};console.log("AI-Analyzer Background: Sending response to content script",a),n(a)}).catch(e=>{console.error("AI-Analyzer Background: Error calling backend:",e),n({error:`ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ²ÑÐ·Ð¸ Ñ backend: ${e.message}`})}),!0):(console.error("AI-Analyzer Background: TraceId is missing"),n({error:"TraceId Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ð² Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ"}),!1)}return console.warn("AI-Analyzer Background: Unknown message type",r.type),n({error:`ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ñ‚Ð¸Ð¿ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ: ${r.type}`}),!1});chrome.runtime.onInstalled.addListener(r=>{console.log("AI-Analyzer Background: Extension installed",r),r.reason==="install"?console.log("AI-Analyzer Background: First time installation"):r.reason==="update"&&console.log("AI-Analyzer Background: Extension updated")});chrome.runtime.onStartup.addListener(()=>{console.log("AI-Analyzer Background: Extension started")});console.log("AI-Analyzer Background: Event listeners registered");
